<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 1: AI Handwriting Workbook ‚Äì ÁõæÁõæÊó•ËØ≠</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700;900&family=ZCOOL+XiaoWei&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Yuji+Syuku&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --paper-width: 210mm;
            --paper-height: 297mm;
            --glass-border: rgba(255, 255, 255, 0.4);
            --glass-surface: rgba(255, 255, 255, 0.65);
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%);
            min-height: 100vh;
            color: #1d1d1f;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-bottom: 50px;
        }

        .glass-nav {
            background: var(--glass-surface);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            position: sticky;
            top: 20px;
            z-index: 50;
            width: 90%;
            max-width: 1000px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            margin-bottom: 3rem;
            margin-top: 1rem;
            border-radius: 2rem;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.05);
        }

        .test-page {
            width: var(--paper-width);
            height: var(--paper-height);
            background: white;
            padding: 20mm;
            margin-bottom: 60px;
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.15);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        h1 {
            font-family: 'ZCOOL XiaoWei', serif;
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            text-align: center;
            color: #1e293b;
        }

        h2 {
            font-size: 1.2rem;
            font-weight: 700;
            border-bottom: 2px solid #cbd5e1;
            padding-bottom: 0.5rem;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: #334155;
        }

        h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .grid-5 {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 1rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .question-box {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 0.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: #fff;
            position: relative;
            transition: all 0.3s ease;
        }

        .question-box.checking {
            border-color: #fbbf24;
            box-shadow: 0 0 0 3px rgba(251, 191, 36, 0.3);
        }

        .question-box.correct-ai {
            border-color: #22c55e;
            background-color: #f0fdf4;
            box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
        }

        .question-box.incorrect-ai {
            border-color: #ef4444;
            background-color: #fef2f2;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
        }

        .question-box.wide {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 1.5rem;
        }

        .label {
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.5rem;
            z-index: 10;
        }

        .question-box.wide .label {
            margin-bottom: 0;
        }

        input[type="text"] {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.5rem;
            width: 100%;
            text-align: center;
            font-size: 1.2rem;
            outline: none;
            font-family: 'Noto Sans JP', sans-serif;
            z-index: 20;
            background: rgba(255, 255, 255, 0.9);
        }

        .question-box.wide input {
            width: 50%;
        }

        input:focus {
            border-color: #6366f1;
        }

        /* Canvas & AI Overlay */
        canvas.handwriting-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 15;
            cursor: crosshair;
            touch-action: none;
            border-radius: 12px;
            display: none;
        }

        .ghost-answer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-family: 'Yuji Syuku', serif;
            font-size: 2.5rem;
            color: #ef4444;
            opacity: 0;
            pointer-events: none;
            z-index: 5;
            transition: opacity 0.5s;
        }

        .question-box.wide .ghost-answer {
            left: 75%;
            font-size: 2rem;
        }

        .page-number {
            position: absolute;
            bottom: 15mm;
            left: 0;
            right: 0;
            text-align: center;
            color: #94a3b8;
            font-size: 0.8rem;
        }

        @media print {
            body {
                background: none;
                display: block;
                padding: 0;
            }

            .glass-nav {
                display: none !important;
            }

            .test-page {
                box-shadow: none;
                margin: 0;
                page-break-after: always;
                width: 100%;
                height: 100%;
            }

            input {
                border: none;
                border-bottom: 1px solid #000;
            }
        }

        /* Mode Switching */
        body.mode-handwriting input {
            display: none;
        }

        body.mode-handwriting canvas {
            display: block;
        }

        body.mode-handwriting .question-box {
            border: 1px dashed #cbd5e1;
            height: 100px;
        }

        body.mode-handwriting .question-box.wide {
            height: auto;
            min-height: 80px;
        }

        /* Spinner */
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #6366f1;
            animation: spin 1s linear infinite;
            display: none;
        }

        #ai-status-loader {
            display: none;
        }
    </style>
</head>

<body class="mode-typing">

    <nav class="glass-nav no-print">
        <div class="flex items-center gap-4">
            <a href="chapter1.html"
                class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white font-bold text-xl shadow-lg hover:scale-105 transition">‚Üê</a>
            <div>
                <h2 class="text-sm font-bold text-slate-800 m-0 border-none p-0 mt-0">Chapter 1 Workbook</h2>
                <span class="text-[10px] text-slate-500 uppercase tracking-widest">AI Edition</span>
            </div>
        </div>

        <div class="flex items-center gap-3 bg-white/50 px-4 py-2 rounded-full border border-white/60 shadow-sm">
            <span class="text-xs font-bold text-slate-500 uppercase">Input:</span>
            <button onclick="setMode('typing')" id="btn-typing"
                class="px-3 py-1 rounded-lg text-sm font-bold bg-indigo-100 text-indigo-700 transition">‚å®Ô∏è Type</button>
            <button onclick="setMode('handwriting')" id="btn-writing"
                class="px-3 py-1 rounded-lg text-sm font-bold text-slate-400 hover:text-slate-600 transition">‚úçÔ∏è
                Write</button>
        </div>

        <div class="flex items-center gap-2">
            <!-- Visual Check (Instant) -->
            <button onclick="gradeVisual()"
                class="px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-full font-bold text-sm transition"
                title="Show Ghost Answer (Red)">
                üëÄ Visual
            </button>

            <!-- AI Check (Gemini) -->
            <button onclick="gradeWithAI()"
                class="px-5 py-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white rounded-full font-bold shadow-lg flex items-center gap-2 transition text-sm">
                <span id="ai-icon">‚ú®</span> AI Check
                <div id="ai-status-loader" class="spinner w-4 h-4 border-2"></div>
            </button>

            <button onclick="window.print()"
                class="w-10 h-10 rounded-full bg-slate-800 text-white flex items-center justify-center hover:bg-slate-700">üñ®Ô∏è</button>
        </div>
    </nav>

    <div id="ai-message"
        class="hidden fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-black/80 text-white px-6 py-3 rounded-full shadow-2xl z-50 text-sm font-bold animate-pulse">
        ü§ñ AI is analyzing your handwriting...
    </div>

    <form id="test-form">

        <!-- PAGE 1: HIRAGANA GRID A-NA -->
        <article class="test-page">
            <h1>Hiragana Part 1</h1>
            <p class="text-center text-slate-400 mb-8">A - Na Rows</p>
            <div class="flex-grow flex flex-col gap-6">
                <!-- A Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„ÅÇ"><span class="label">A</span><input type="text">
                        <div class="ghost-answer">„ÅÇ</div>
                    </div>
                    <div class="question-box" data-answer="„ÅÑ"><span class="label">I</span><input type="text">
                        <div class="ghost-answer">„ÅÑ</div>
                    </div>
                    <div class="question-box" data-answer="„ÅÜ"><span class="label">U</span><input type="text">
                        <div class="ghost-answer">„ÅÜ</div>
                    </div>
                    <div class="question-box" data-answer="„Åà"><span class="label">E</span><input type="text">
                        <div class="ghost-answer">„Åà</div>
                    </div>
                    <div class="question-box" data-answer="„Åä"><span class="label">O</span><input type="text">
                        <div class="ghost-answer">„Åä</div>
                    </div>
                </div>
                <!-- Ka Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åã"><span class="label">Ka</span><input type="text">
                        <div class="ghost-answer">„Åã</div>
                    </div>
                    <div class="question-box" data-answer="„Åç"><span class="label">Ki</span><input type="text">
                        <div class="ghost-answer">„Åç</div>
                    </div>
                    <div class="question-box" data-answer="„Åè"><span class="label">Ku</span><input type="text">
                        <div class="ghost-answer">„Åè</div>
                    </div>
                    <div class="question-box" data-answer="„Åë"><span class="label">Ke</span><input type="text">
                        <div class="ghost-answer">„Åë</div>
                    </div>
                    <div class="question-box" data-answer="„Åì"><span class="label">Ko</span><input type="text">
                        <div class="ghost-answer">„Åì</div>
                    </div>
                </div>
                <!-- Sa Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åï"><span class="label">Sa</span><input type="text">
                        <div class="ghost-answer">„Åï</div>
                    </div>
                    <div class="question-box" data-answer="„Åó"><span class="label">Shi</span><input type="text">
                        <div class="ghost-answer">„Åó</div>
                    </div>
                    <div class="question-box" data-answer="„Åô"><span class="label">Su</span><input type="text">
                        <div class="ghost-answer">„Åô</div>
                    </div>
                    <div class="question-box" data-answer="„Åõ"><span class="label">Se</span><input type="text">
                        <div class="ghost-answer">„Åõ</div>
                    </div>
                    <div class="question-box" data-answer="„Åù"><span class="label">So</span><input type="text">
                        <div class="ghost-answer">„Åù</div>
                    </div>
                </div>
                <!-- Ta Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åü"><span class="label">Ta</span><input type="text">
                        <div class="ghost-answer">„Åü</div>
                    </div>
                    <div class="question-box" data-answer="„Å°"><span class="label">Chi</span><input type="text">
                        <div class="ghost-answer">„Å°</div>
                    </div>
                    <div class="question-box" data-answer="„Å§"><span class="label">Tsu</span><input type="text">
                        <div class="ghost-answer">„Å§</div>
                    </div>
                    <div class="question-box" data-answer="„Å¶"><span class="label">Te</span><input type="text">
                        <div class="ghost-answer">„Å¶</div>
                    </div>
                    <div class="question-box" data-answer="„Å®"><span class="label">To</span><input type="text">
                        <div class="ghost-answer">„Å®</div>
                    </div>
                </div>
                <!-- Na Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Å™"><span class="label">Na</span><input type="text">
                        <div class="ghost-answer">„Å™</div>
                    </div>
                    <div class="question-box" data-answer="„Å´"><span class="label">Ni</span><input type="text">
                        <div class="ghost-answer">„Å´</div>
                    </div>
                    <div class="question-box" data-answer="„Å¨"><span class="label">Nu</span><input type="text">
                        <div class="ghost-answer">„Å¨</div>
                    </div>
                    <div class="question-box" data-answer="„Å≠"><span class="label">Ne</span><input type="text">
                        <div class="ghost-answer">„Å≠</div>
                    </div>
                    <div class="question-box" data-answer="„ÅÆ"><span class="label">No</span><input type="text">
                        <div class="ghost-answer">„ÅÆ</div>
                    </div>
                </div>
                <!-- Construction -->
                <div class="mt-auto border-t pt-4">
                    <h3>Construction</h3>
                    <div class="grid-2">
                        <div class="question-box wide" data-answer="„ÅÇ„Åä"><span class="label">A + O (Blue)</span><input
                                type="text">
                            <div class="ghost-answer">„ÅÇ„Åä</div>
                        </div>
                        <div class="question-box wide" data-answer="„ÅÜ„Åà"><span class="label">U + E (Up)</span><input
                                type="text">
                            <div class="ghost-answer">„ÅÜ„Åà</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-number">1 / 8</div>
        </article>

        <!-- PAGE 2: HIRAGANA GRID HA-N -->
        <article class="test-page">
            <h1>Hiragana Part 2</h1>
            <p class="text-center text-slate-400 mb-8">Ha - N Rows</p>
            <div class="flex-grow flex flex-col gap-6">
                <!-- Ha Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„ÅØ"><span class="label">Ha</span><input type="text">
                        <div class="ghost-answer">„ÅØ</div>
                    </div>
                    <div class="question-box" data-answer="„Å≤"><span class="label">Hi</span><input type="text">
                        <div class="ghost-answer">„Å≤</div>
                    </div>
                    <div class="question-box" data-answer="„Åµ"><span class="label">Fu</span><input type="text">
                        <div class="ghost-answer">„Åµ</div>
                    </div>
                    <div class="question-box" data-answer="„Å∏"><span class="label">He</span><input type="text">
                        <div class="ghost-answer">„Å∏</div>
                    </div>
                    <div class="question-box" data-answer="„Åª"><span class="label">Ho</span><input type="text">
                        <div class="ghost-answer">„Åª</div>
                    </div>
                </div>
                <!-- Ma Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åæ"><span class="label">Ma</span><input type="text">
                        <div class="ghost-answer">„Åæ</div>
                    </div>
                    <div class="question-box" data-answer="„Åø"><span class="label">Mi</span><input type="text">
                        <div class="ghost-answer">„Åø</div>
                    </div>
                    <div class="question-box" data-answer="„ÇÄ"><span class="label">Mu</span><input type="text">
                        <div class="ghost-answer">„ÇÄ</div>
                    </div>
                    <div class="question-box" data-answer="„ÇÅ"><span class="label">Me</span><input type="text">
                        <div class="ghost-answer">„ÇÅ</div>
                    </div>
                    <div class="question-box" data-answer="„ÇÇ"><span class="label">Mo</span><input type="text">
                        <div class="ghost-answer">„ÇÇ</div>
                    </div>
                </div>
                <!-- Ya Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„ÇÑ"><span class="label">Ya</span><input type="text">
                        <div class="ghost-answer">„ÇÑ</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„ÇÜ"><span class="label">Yu</span><input type="text">
                        <div class="ghost-answer">„ÇÜ</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„Çà"><span class="label">Yo</span><input type="text">
                        <div class="ghost-answer">„Çà</div>
                    </div>
                </div>
                <!-- Ra Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Çâ"><span class="label">Ra</span><input type="text">
                        <div class="ghost-answer">„Çâ</div>
                    </div>
                    <div class="question-box" data-answer="„Çä"><span class="label">Ri</span><input type="text">
                        <div class="ghost-answer">„Çä</div>
                    </div>
                    <div class="question-box" data-answer="„Çã"><span class="label">Ru</span><input type="text">
                        <div class="ghost-answer">„Çã</div>
                    </div>
                    <div class="question-box" data-answer="„Çå"><span class="label">Re</span><input type="text">
                        <div class="ghost-answer">„Çå</div>
                    </div>
                    <div class="question-box" data-answer="„Çç"><span class="label">Ro</span><input type="text">
                        <div class="ghost-answer">„Çç</div>
                    </div>
                </div>
                <!-- Wa Row & N -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Çè"><span class="label">Wa</span><input type="text">
                        <div class="ghost-answer">„Çè</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„Çí"><span class="label">Wo</span><input type="text">
                        <div class="ghost-answer">„Çí</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„Çì"><span class="label">N</span><input type="text">
                        <div class="ghost-answer">„Çì</div>
                    </div>
                </div>
                <div class="mt-auto border-t pt-4">
                    <h3>Particles</h3>
                    <div class="grid-2">
                        <div class="question-box wide" data-answer="„ÅØ"><span class="label">Topic (Wa)</span><input
                                type="text">
                            <div class="ghost-answer">„ÅØ</div>
                        </div>
                        <div class="question-box wide" data-answer="„Çí"><span class="label">Object (O)</span><input
                                type="text">
                            <div class="ghost-answer">„Çí</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-number">2 / 8</div>
        </article>

        <!-- PAGE 3: KATAKANA A-NO -->
        <article class="test-page">
            <h1>Katakana Part 1</h1>
            <p class="text-center text-slate-400 mb-8">Hiragana -> Katakana (A - No)</p>
            <div class="flex-grow flex flex-col gap-6">
                <!-- A Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Ç¢"><span class="label">„ÅÇ</span><input type="text">
                        <div class="ghost-answer">„Ç¢</div>
                    </div>
                    <div class="question-box" data-answer="„Ç§"><span class="label">„ÅÑ</span><input type="text">
                        <div class="ghost-answer">„Ç§</div>
                    </div>
                    <div class="question-box" data-answer="„Ç¶"><span class="label">„ÅÜ</span><input type="text">
                        <div class="ghost-answer">„Ç¶</div>
                    </div>
                    <div class="question-box" data-answer="„Ç®"><span class="label">„Åà</span><input type="text">
                        <div class="ghost-answer">„Ç®</div>
                    </div>
                    <div class="question-box" data-answer="„Ç™"><span class="label">„Åä</span><input type="text">
                        <div class="ghost-answer">„Ç™</div>
                    </div>
                </div>
                <!-- Ka Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Ç´"><span class="label">„Åã</span><input type="text">
                        <div class="ghost-answer">„Ç´</div>
                    </div>
                    <div class="question-box" data-answer="„Ç≠"><span class="label">„Åç</span><input type="text">
                        <div class="ghost-answer">„Ç≠</div>
                    </div>
                    <div class="question-box" data-answer="„ÇØ"><span class="label">„Åè</span><input type="text">
                        <div class="ghost-answer">„ÇØ</div>
                    </div>
                    <div class="question-box" data-answer="„Ç±"><span class="label">„Åë</span><input type="text">
                        <div class="ghost-answer">„Ç±</div>
                    </div>
                    <div class="question-box" data-answer="„Ç≥"><span class="label">„Åì</span><input type="text">
                        <div class="ghost-answer">„Ç≥</div>
                    </div>
                </div>
                <!-- Sa Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Çµ"><span class="label">„Åï</span><input type="text">
                        <div class="ghost-answer">„Çµ</div>
                    </div>
                    <div class="question-box" data-answer="„Ç∑"><span class="label">„Åó</span><input type="text">
                        <div class="ghost-answer">„Ç∑</div>
                    </div>
                    <div class="question-box" data-answer="„Çπ"><span class="label">„Åô</span><input type="text">
                        <div class="ghost-answer">„Çπ</div>
                    </div>
                    <div class="question-box" data-answer="„Çª"><span class="label">„Åõ</span><input type="text">
                        <div class="ghost-answer">„Çª</div>
                    </div>
                    <div class="question-box" data-answer="„ÇΩ"><span class="label">„Åù</span><input type="text">
                        <div class="ghost-answer">„ÇΩ</div>
                    </div>
                </div>
                <!-- Ta Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Çø"><span class="label">„Åü</span><input type="text">
                        <div class="ghost-answer">„Çø</div>
                    </div>
                    <div class="question-box" data-answer="„ÉÅ"><span class="label">„Å°</span><input type="text">
                        <div class="ghost-answer">„ÉÅ</div>
                    </div>
                    <div class="question-box" data-answer="„ÉÑ"><span class="label">„Å§</span><input type="text">
                        <div class="ghost-answer">„ÉÑ</div>
                    </div>
                    <div class="question-box" data-answer="„ÉÜ"><span class="label">„Å¶</span><input type="text">
                        <div class="ghost-answer">„ÉÜ</div>
                    </div>
                    <div class="question-box" data-answer="„Éà"><span class="label">„Å®</span><input type="text">
                        <div class="ghost-answer">„Éà</div>
                    </div>
                </div>
                <!-- Na Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Éä"><span class="label">„Å™</span><input type="text">
                        <div class="ghost-answer">„Éä</div>
                    </div>
                    <div class="question-box" data-answer="„Éã"><span class="label">„Å´</span><input type="text">
                        <div class="ghost-answer">„Éã</div>
                    </div>
                    <div class="question-box" data-answer="„Éå"><span class="label">„Å¨</span><input type="text">
                        <div class="ghost-answer">„Éå</div>
                    </div>
                    <div class="question-box" data-answer="„Éç"><span class="label">„Å≠</span><input type="text">
                        <div class="ghost-answer">„Éç</div>
                    </div>
                    <div class="question-box" data-answer="„Éé"><span class="label">„ÅÆ</span><input type="text">
                        <div class="ghost-answer">„Éé</div>
                    </div>
                </div>
                <div class="mt-auto border-t pt-4">
                    <h3>Speed Check</h3>
                    <div class="grid-2">
                        <div class="question-box wide" data-answer="„Ç¢"><span class="label">Kana for 'A'</span><input
                                type="text">
                            <div class="ghost-answer">„Ç¢</div>
                        </div>
                        <div class="question-box wide" data-answer="„Ç∑"><span class="label">Kana for 'Shi'</span><input
                                type="text">
                            <div class="ghost-answer">„Ç∑</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-number">3 / 8</div>
        </article>

        <!-- PAGE 4: KATAKANA HANDWRITING II -->
        <article class="test-page">
            <h1>Katakana Part 2</h1>
            <p class="text-center text-slate-400 mb-8">Hiragana -> Katakana (Ha - N)</p>
            <div class="flex-grow flex flex-col gap-6">
                <!-- Ha Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Éè"><span class="label">„ÅØ</span><input type="text">
                        <div class="ghost-answer">„Éè</div>
                    </div>
                    <div class="question-box" data-answer="„Éí"><span class="label">„Å≤</span><input type="text">
                        <div class="ghost-answer">„Éí</div>
                    </div>
                    <div class="question-box" data-answer="„Éï"><span class="label">„Åµ</span><input type="text">
                        <div class="ghost-answer">„Éï</div>
                    </div>
                    <div class="question-box" data-answer="„Éò"><span class="label">„Å∏</span><input type="text">
                        <div class="ghost-answer">„Éò</div>
                    </div>
                    <div class="question-box" data-answer="„Éõ"><span class="label">„Åª</span><input type="text">
                        <div class="ghost-answer">„Éõ</div>
                    </div>
                </div>

                <!-- Ma Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Éû"><span class="label">„Åæ</span><input type="text">
                        <div class="ghost-answer">„Éû</div>
                    </div>
                    <div class="question-box" data-answer="„Éü"><span class="label">„Åø</span><input type="text">
                        <div class="ghost-answer">„Éü</div>
                    </div>
                    <div class="question-box" data-answer="„É†"><span class="label">„ÇÄ</span><input type="text">
                        <div class="ghost-answer">„É†</div>
                    </div>
                    <div class="question-box" data-answer="„É°"><span class="label">„ÇÅ</span><input type="text">
                        <div class="ghost-answer">„É°</div>
                    </div>
                    <div class="question-box" data-answer="„É¢"><span class="label">„ÇÇ</span><input type="text">
                        <div class="ghost-answer">„É¢</div>
                    </div>
                </div>

                <!-- Ya Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„É§"><span class="label">„ÇÑ</span><input type="text">
                        <div class="ghost-answer">„É§</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„É¶"><span class="label">„ÇÜ</span><input type="text">
                        <div class="ghost-answer">„É¶</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„É®"><span class="label">„Çà</span><input type="text">
                        <div class="ghost-answer">„É®</div>
                    </div>
                </div>

                <!-- Ra Row -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„É©"><span class="label">„Çâ</span><input type="text">
                        <div class="ghost-answer">„É©</div>
                    </div>
                    <div class="question-box" data-answer="„É™"><span class="label">„Çä</span><input type="text">
                        <div class="ghost-answer">„É™</div>
                    </div>
                    <div class="question-box" data-answer="„É´"><span class="label">„Çã</span><input type="text">
                        <div class="ghost-answer">„É´</div>
                    </div>
                    <div class="question-box" data-answer="„É¨"><span class="label">„Çå</span><input type="text">
                        <div class="ghost-answer">„É¨</div>
                    </div>
                    <div class="question-box" data-answer="„É≠"><span class="label">„Çç</span><input type="text">
                        <div class="ghost-answer">„É≠</div>
                    </div>
                </div>

                <!-- Wa Row & N -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„ÉØ"><span class="label">„Çè</span><input type="text">
                        <div class="ghost-answer">„ÉØ</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„É≤"><span class="label">„Çí</span><input type="text">
                        <div class="ghost-answer">„É≤</div>
                    </div>
                    <div class="question-box bg-slate-50 border-none shadow-none"></div>
                    <div class="question-box" data-answer="„É≥"><span class="label">„Çì</span><input type="text">
                        <div class="ghost-answer">„É≥</div>
                    </div>
                </div>

                <div class="mt-auto border-t pt-4">
                    <h3>Loan Words (Katakana)</h3>
                    <div class="grid-2">
                        <div class="question-box wide" data-answer="„Ç≥„Éº„Éí„Éº"><span class="label">Ko-hi-
                                (Coffee)</span><input type="text">
                            <div class="ghost-answer">„Ç≥„Éº„Éí„Éº</div>
                        </div>
                        <div class="question-box wide" data-answer="„Éì„Éº„É´"><span class="label">Bi-ru (Beer)</span><input
                                type="text">
                            <div class="ghost-answer">„Éì„Éº„É´</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-number">4 / 8</div>
        </article>

        <!-- PAGE 5: DAKUON FULL -->
        <article class="test-page">
            <h1>Dakuon (Voiced)</h1>
            <p class="text-center text-slate-400 mb-8">Ga, Za, Da, Ba, Pa</p>
            <div class="flex-grow flex flex-col gap-6">
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åå"><span class="label">Ga</span><input type="text">
                        <div class="ghost-answer">„Åå</div>
                    </div>
                    <div class="question-box" data-answer="„Åé"><span class="label">Gi</span><input type="text">
                        <div class="ghost-answer">„Åé</div>
                    </div>
                    <div class="question-box" data-answer="„Åê"><span class="label">Gu</span><input type="text">
                        <div class="ghost-answer">„Åê</div>
                    </div>
                    <div class="question-box" data-answer="„Åí"><span class="label">Ge</span><input type="text">
                        <div class="ghost-answer">„Åí</div>
                    </div>
                    <div class="question-box" data-answer="„Åî"><span class="label">Go</span><input type="text">
                        <div class="ghost-answer">„Åî</div>
                    </div>
                </div>
                <!-- Z -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åñ"><span class="label">Za</span><input type="text">
                        <div class="ghost-answer">„Åñ</div>
                    </div>
                    <div class="question-box" data-answer="„Åò"><span class="label">Ji</span><input type="text">
                        <div class="ghost-answer">„Åò</div>
                    </div>
                    <div class="question-box" data-answer="„Åö"><span class="label">Zu</span><input type="text">
                        <div class="ghost-answer">„Åö</div>
                    </div>
                    <div class="question-box" data-answer="„Åú"><span class="label">Ze</span><input type="text">
                        <div class="ghost-answer">„Åú</div>
                    </div>
                    <div class="question-box" data-answer="„Åû"><span class="label">Zo</span><input type="text">
                        <div class="ghost-answer">„Åû</div>
                    </div>
                </div>
                <!-- D -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Å†"><span class="label">Da</span><input type="text">
                        <div class="ghost-answer">„Å†</div>
                    </div>
                    <div class="question-box" data-answer="„Å¢"><span class="label">Ji</span><input type="text">
                        <div class="ghost-answer">„Å¢</div>
                    </div>
                    <div class="question-box" data-answer="„Å•"><span class="label">Zu</span><input type="text">
                        <div class="ghost-answer">„Å•</div>
                    </div>
                    <div class="question-box" data-answer="„Åß"><span class="label">De</span><input type="text">
                        <div class="ghost-answer">„Åß</div>
                    </div>
                    <div class="question-box" data-answer="„Å©"><span class="label">Do</span><input type="text">
                        <div class="ghost-answer">„Å©</div>
                    </div>
                </div>
                <!-- B -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Å∞"><span class="label">Ba</span><input type="text">
                        <div class="ghost-answer">„Å∞</div>
                    </div>
                    <div class="question-box" data-answer="„Å≥"><span class="label">Bi</span><input type="text">
                        <div class="ghost-answer">„Å≥</div>
                    </div>
                    <div class="question-box" data-answer="„Å∂"><span class="label">Bu</span><input type="text">
                        <div class="ghost-answer">„Å∂</div>
                    </div>
                    <div class="question-box" data-answer="„Åπ"><span class="label">Be</span><input type="text">
                        <div class="ghost-answer">„Åπ</div>
                    </div>
                    <div class="question-box" data-answer="„Åº"><span class="label">Bo</span><input type="text">
                        <div class="ghost-answer">„Åº</div>
                    </div>
                </div>
                <!-- P -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Å±"><span class="label">Pa</span><input type="text">
                        <div class="ghost-answer">„Å±</div>
                    </div>
                    <div class="question-box" data-answer="„Å¥"><span class="label">Pi</span><input type="text">
                        <div class="ghost-answer">„Å¥</div>
                    </div>
                    <div class="question-box" data-answer="„Å∑"><span class="label">Pu</span><input type="text">
                        <div class="ghost-answer">„Å∑</div>
                    </div>
                    <div class="question-box" data-answer="„Å∫"><span class="label">Pe</span><input type="text">
                        <div class="ghost-answer">„Å∫</div>
                    </div>
                    <div class="question-box" data-answer="„ÅΩ"><span class="label">Po</span><input type="text">
                        <div class="ghost-answer">„ÅΩ</div>
                    </div>
                </div>
            </div>
            <div class="page-number">5 / 8</div>
        </article>

        <!-- PAGE 6: YOO & SOKUON -->
        <article class="test-page">
            <h1>Yoon & Sokuon</h1>
            <p class="text-center text-slate-400 mb-8">Combined & Double Consonants</p>
            <div class="flex-grow flex flex-col gap-6">
                <!-- Ky- -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åç„ÇÉ"><span class="label">Kya</span><input type="text">
                        <div class="ghost-answer">„Åç„ÇÉ</div>
                    </div>
                    <div class="question-box" data-answer="„Åç„ÇÖ"><span class="label">Kyu</span><input type="text">
                        <div class="ghost-answer">„Åç„ÇÖ</div>
                    </div>
                    <div class="question-box" data-answer="„Åç„Çá"><span class="label">Kyo</span><input type="text">
                        <div class="ghost-answer">„Åç„Çá</div>
                    </div>
                    <div class="col-span-2"></div>
                </div>
                <!-- Sh- -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Åó„ÇÉ"><span class="label">Sha</span><input type="text">
                        <div class="ghost-answer">„Åó„ÇÉ</div>
                    </div>
                    <div class="question-box" data-answer="„Åó„ÇÖ"><span class="label">Shu</span><input type="text">
                        <div class="ghost-answer">„Åó„ÇÖ</div>
                    </div>
                    <div class="question-box" data-answer="„Åó„Çá"><span class="label">Sho</span><input type="text">
                        <div class="ghost-answer">„Åó„Çá</div>
                    </div>
                    <div class="col-span-2"></div>
                </div>
                <!-- Ch- -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Å°„ÇÉ"><span class="label">Cha</span><input type="text">
                        <div class="ghost-answer">„Å°„ÇÉ</div>
                    </div>
                    <div class="question-box" data-answer="„Å°„ÇÖ"><span class="label">Chu</span><input type="text">
                        <div class="ghost-answer">„Å°„ÇÖ</div>
                    </div>
                    <div class="question-box" data-answer="„Å°„Çá"><span class="label">Cho</span><input type="text">
                        <div class="ghost-answer">„Å°„Çá</div>
                    </div>
                    <div class="col-span-2"></div>
                </div>
                <!-- Ny- -->
                <div class="grid-5">
                    <div class="question-box" data-answer="„Å´„ÇÉ"><span class="label">Nya</span><input type="text">
                        <div class="ghost-answer">„Å´„ÇÉ</div>
                    </div>
                    <div class="question-box" data-answer="„Å´„ÇÖ"><span class="label">Nyu</span><input type="text">
                        <div class="ghost-answer">„Å´„ÇÖ</div>
                    </div>
                    <div class="question-box" data-answer="„Å´„Çá"><span class="label">Nyo</span><input type="text">
                        <div class="ghost-answer">„Å´„Çá</div>
                    </div>
                    <div class="col-span-2"></div>
                </div>
                <div class="mt-auto border-t pt-4">
                    <h3>Double Consonant</h3>
                    <div class="grid-2">
                        <div class="question-box wide" data-answer="„Åç„Å£„Å∑"><span class="label">Kip-pu</span><input
                                type="text">
                            <div class="ghost-answer">„Åç„Å£„Å∑</div>
                        </div>
                        <div class="question-box wide" data-answer="„Åå„Å£„Åì„ÅÜ"><span class="label">Gak-kou</span><input
                                type="text">
                            <div class="ghost-answer">„Åå„Å£„Åì„ÅÜ</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="page-number">6 / 8</div>
        </article>

        <!-- PAGE 7: VOCABULARY -->
        <article class="test-page">
            <h1>Vocabulary</h1>
            <p class="text-center text-slate-400 mb-8">Hiragana <-> English</p>
            <div class="grid-2 w-full gap-4">
                <!-- Column 1 -->
                <div class="flex flex-col gap-2">
                    <div class="question-box wide" data-answer="love"><span class="label">„ÅÇ„ÅÑ</span><input type="text">
                        <div class="ghost-answer">love</div>
                    </div>
                    <div class="question-box wide" data-answer="blue"><span class="label">„ÅÇ„Åä„ÅÑ</span><input type="text">
                        <div class="ghost-answer">blue</div>
                    </div>
                    <div class="question-box wide" data-answer="up"><span class="label">„ÅÜ„Åà</span><input type="text">
                        <div class="ghost-answer">up</div>
                    </div>
                    <div class="question-box wide" data-answer="no"><span class="label">„ÅÑ„ÅÑ„Åà</span><input type="text">
                        <div class="ghost-answer">no</div>
                    </div>
                    <div class="question-box wide" data-answer="yes"><span class="label">„ÅØ„ÅÑ</span><input type="text">
                        <div class="ghost-answer">yes</div>
                    </div>
                    <div class="question-box wide" data-answer="face"><span class="label">„Åã„Åä</span><input type="text">
                        <div class="ghost-answer">face</div>
                    </div>
                    <div class="question-box wide" data-answer="listen"><span class="label">„Åç„Åè</span><input type="text">
                        <div class="ghost-answer">listen</div>
                    </div>
                </div>
                <!-- Column 2 -->
                <div class="flex flex-col gap-2">
                    <div class="question-box wide" data-answer="„Åó„Çç"><span class="label">White</span><input type="text">
                        <div class="ghost-answer">„Åó„Çç</div>
                    </div>
                    <div class="question-box wide" data-answer="„ÅÇ„Åã"><span class="label">Red</span><input type="text">
                        <div class="ghost-answer">„ÅÇ„Åã</div>
                    </div>
                    <div class="question-box wide" data-answer="„Çà„ÇÄ"><span class="label">Read</span><input type="text">
                        <div class="ghost-answer">„Çà„ÇÄ</div>
                    </div>
                    <div class="question-box wide" data-answer="„ÅÑ„Å¨"><span class="label">Dog</span><input type="text">
                        <div class="ghost-answer">„ÅÑ„Å¨</div>
                    </div>
                    <div class="question-box wide" data-answer="„Å®„Çä"><span class="label">Bird</span><input type="text">
                        <div class="ghost-answer">„Å®„Çä</div>
                    </div>
                    <div class="question-box wide" data-answer="„Åµ„ÇÜ"><span class="label">Winter</span><input type="text">
                        <div class="ghost-answer">„Åµ„ÇÜ</div>
                    </div>
                    <div class="question-box wide" data-answer="„Åè„ÇÇ"><span class="label">Cloud</span><input type="text">
                        <div class="ghost-answer">„Åè„ÇÇ</div>
                    </div>
                </div>
            </div>
            <div class="page-number">7 / 8</div>
        </article>

        <!-- PAGE 8: MASTERY + PARTICLES -->
        <article class="test-page">
            <h1>Final Mastery</h1>
            <p class="text-center text-slate-400 mb-8">Particles & Final Check</p>
            <div class="flex-grow flex flex-col justify-center items-center gap-12">
                <div class="w-full bg-slate-50 p-6 rounded-2xl border border-slate-200">
                    <h3 class="text-center mb-6">Fill in the correct particle (Wa / Wo / He)</h3>
                    <div class="flex flex-col gap-4">
                        <div class="flex items-center justify-center gap-2 text-xl">
                            <span>„Çè„Åü„Åó</span>
                            <input type="text" data-answer="„ÅØ" class="!w-12 border-b-2 border-slate-300">
                            <span>„Åå„Åè„Åõ„ÅÑ „Åß„Åô„ÄÇ</span>
                        </div>
                        <div class="text-center text-sm text-slate-400">(I am a student)</div>
                        <div class="flex items-center justify-center gap-2 text-xl mt-4">
                            <span>„Åì„Çå</span>
                            <input type="text" data-answer="„Çí" class="!w-12 border-b-2 border-slate-300">
                            <span>„Åè„Å†„Åï„ÅÑ„ÄÇ</span>
                        </div>
                        <div class="text-center text-sm text-slate-400">(This please)</div>
                    </div>
                </div>

                <div class="text-center">
                    <h2 class="border-none mb-4">Complete Chapter 1</h2>

                    <button onclick="gradeVisual(); window.print();"
                        class="px-10 py-4 bg-indigo-600 text-white font-bold rounded-full shadow-xl hover:scale-105 transition no-print text-lg">
                        Submit & Print
                    </button>

                    <div id="final-result"
                        class="hidden mt-8 p-6 bg-green-50 text-green-800 rounded-2xl border border-green-200 text-2xl font-bold shadow-sm">
                        Score: <span id="display-score">0</span> / 100
                    </div>
                </div>
            </div>
            <div class="page-number">8 / 8</div>
        </article>

    </form>

    <script>
        const API_KEY = "AIzaSyANEpdPzKlnII7-Xzp2bJvBFJitPD1AEdY";
        let currentMode = 'typing';
        const body = document.body;
        const btnTyping = document.getElementById('btn-typing');
        const btnWriting = document.getElementById('btn-writing');

        function setMode(mode) {
            currentMode = mode;
            body.className = 'mode-' + mode;
            if(mode === 'typing') {
                btnTyping.className = "px-3 py-1 rounded-lg text-sm font-bold bg-indigo-100 text-indigo-700 transition";
                btnWriting.className = "px-3 py-1 rounded-lg text-sm font-bold text-slate-400 hover:text-slate-600 transition";
            } else {
                btnWriting.className = "px-3 py-1 rounded-lg text-sm font-bold bg-indigo-100 text-indigo-700 transition";
                btnTyping.className = "px-3 py-1 rounded-lg text-sm font-bold text-slate-400 hover:text-slate-600 transition";
                document.querySelectorAll('.question-box').forEach(box => {
                    if(!box.querySelector('canvas')) createCanvas(box);
                });
            }
        }
        
        function createCanvas(container) {
            if(container.classList.contains('border-none') || !container.dataset.answer) return;
            const canvas = document.createElement('canvas');
            canvas.className = 'handwriting-canvas';
            container.appendChild(canvas);
            requestAnimationFrame(() => resizeCanvas(canvas));
            
            const ctx = canvas.getContext('2d');
            let isDrawing = false, lastX = 0, lastY = 0;
            
            const startDraw = (e) => {
                isDrawing = true;
                const {x, y} = getPos(e, canvas);
                lastX = x; lastY = y;
                canvas.dataset.hasDrawing = "true";
            };
            const draw = (e) => {
                if(!isDrawing) return;
                e.preventDefault();
                const {x, y} = getPos(e, canvas);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 3;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.stroke();
                lastX = x; lastY = y;
            };
            const stopDraw = () => isDrawing = false;
            
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDraw);
            canvas.addEventListener('mouseout', stopDraw);
            canvas.addEventListener('touchstart', startDraw, {passive: false});
            canvas.addEventListener('touchmove', draw, {passive: false});
            canvas.addEventListener('touchend', stopDraw);
        }
        
        function getPos(e, canvas) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }
        
        function resizeCanvas(canvas) {
            const container = canvas.parentElement;
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }

        // --- VISUAL GRADING ---
        function gradeVisual() {
            if(currentMode === 'typing') {
                // Typing text grading
                let score = 0;
                let count = 0;
                document.querySelectorAll('input').forEach(input => {
                    const box = input.closest('.question-box');
                    if(!box || !box.dataset.answer) return;
                    count++;
                    const val = input.value.trim().toLowerCase();
                    const expected = box.dataset.answer.toLowerCase();
                    if(val === expected) { box.classList.add('correct-bg'); score++; }
                    else { box.classList.add('incorrect-bg'); }
                });
                alert(`Typing Score: ${score} / ${count}`);
            } else {
                // Visual Check: Reveal Ghost
                document.querySelectorAll('.ghost-answer').forEach(ghost => {
                    ghost.style.opacity = '1';
                    ghost.style.color = 'rgba(239, 68, 68, 0.4)';
                });
                alert("Visual Check: Red characters revealed behind your writing.");
            }
        }

        // --- GEMINI AI GRADING ---
        async function gradeWithAI() {
            if (currentMode !== 'handwriting') {
                alert("Please switch to 'Write' mode and draw characters first.");
                return;
            }
            
            const loader = document.getElementById('ai-status-loader');
            const aiMsg = document.getElementById('ai-message');
            loader.style.display = 'block';
            aiMsg.classList.remove('hidden');
            
            const canvases = document.querySelectorAll('canvas.handwriting-canvas');
            let promises = [];
            
            for(let canvas of canvases) {
                if(canvas.dataset.hasDrawing !== "true") continue;
                
                const box = canvas.closest('.question-box');
                const expectedChar = box.dataset.answer;
                const base64Image = canvas.toDataURL('image/png').split(',')[1];
                
                // Add visual loading state to box
                box.classList.add('checking');
                
                // Prepare API Request
                const p = fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [
                                { text: `Does this image look like the Japanese character '${expectedChar}'? If it is reasonably close, answer YES. If it is completely different or illegible, answer NO. Answer with ONLY one word.` },
                                { inline_data: { mime_type: "image/png", data: base64Image } }
                            ]
                        }]
                    })
                })
                .then(res => res.json())
                .then(data => {
                    box.classList.remove('checking');
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text?.trim().toUpperCase();
                    if(text && text.includes("YES")) {
                        box.classList.add('correct-ai');
                    } else {
                        box.classList.add('incorrect-ai');
                    }
                })
                .catch(err => {
                    console.error("AI Error:", err);
                    box.classList.remove('checking');
                });
                
                promises.push(p);
                
                // Rate limit spacing (essential to avoid 429 errors on free tier)
                await new Promise(r => setTimeout(r, 600)); // 1.5 requests per second approx
            }
            
            await Promise.allSettled(promises);
            
            loader.style.display = 'none';
            aiMsg.classList.add('hidden');
            alert("AI Grading Complete!");
        }
    </script>
</body>

</html>